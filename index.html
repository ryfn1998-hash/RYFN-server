<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <title>星河伺服器 - 核心數據監控中心</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --green: #72bd44; --bg: #0d0d0d; --card: #161616; }
        body { background: var(--bg); color: white; font-family: monospace; margin: 0; padding: 20px; }
        .grid { display: grid; grid-template-columns: 1fr 350px; gap: 20px; }
        .card { border: 1px solid #333; background: var(--card); padding: 20px; border-radius: 4px; margin-bottom: 20px; }
        .title { color: var(--green); font-weight: bold; border-bottom: 1px solid var(--green); padding-bottom: 8px; margin-bottom: 15px; }
        .player-unit { display: flex; align-items: center; background: #000; padding: 10px; margin-bottom: 10px; border-left: 3px solid var(--green); }
        .player-unit img { width: 40px; height: 40px; margin-right: 15px; }
        .log { background: #000; height: 350px; overflow-y: auto; padding: 10px; font-size: 0.8rem; color: #888; border: 1px solid #222; }
        .stat-val { color: var(--green); font-size: 1.1rem; }
        canvas { max-height: 200px; }
    </style>
</head>
<body>
    <h2 style="color: var(--green);">REAL-TIME SYSTEM MONITORING: ryfn.falix.gg</h2>
    
    <div class="grid">
        <div class="main-col">
            <div class="card">
                <div class="title">Server Metrics</div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 15px;">
                    <div>狀態: <span id="status" class="stat-val">WAITING</span></div>
                    <div>在線: <span id="players" class="stat-val">0 / 0</span></div>
                    <div>延遲: <span id="ping" class="stat-val">45ms</span></div>
                </div>
                <canvas id="playerChart"></canvas>
            </div>

            <div class="card">
                <div class="title">Active Entity Tracking</div>
                <div id="player-container">掃描中...</div>
            </div>
        </div>

        <div class="side-col">
            <div class="card">
                <div class="title">Activity Log</div>
                <div class="log" id="log-box">初始化監控系統...</div>
            </div>
            <div class="card">
                <div class="title">Session Statistics</div>
                <div id="stats-box" style="font-size: 0.8rem; color: #72bd44;">
                    最長在線: N/A<br>
                    平均延遲: 42ms
                </div>
            </div>
        </div>
    </div>

    <script>
        let lastList = [];
        let historyData = [];
        let labels = [];
        const ctx = document.getElementById('playerChart').getContext('2d');
        const playerChart = new Chart(ctx, {
            type: 'line',
            data: { labels: labels, datasets: [{ label: '在線人數', data: historyData, borderColor: '#72bd44', tension: 0.4 }] },
            options: { scales: { y: { beginAtZero: true, grid: { color: '#222' } }, x: { grid: { display: false } } } }
        });

        async function update() {
            try {
                const res = await fetch('https://api.mcsrvstat.us/2/ryfn.falix.gg');
                const data = await res.json();
                const now = new Date().toLocaleTimeString();

                if (data.online) {
                    document.getElementById('status').innerText = "ONLINE";
                    document.getElementById('players').innerText = `${data.players.online} / ${data.players.max}`;
                    
                    // 更新圖表
                    if (labels.length > 10) { labels.shift(); historyData.shift(); }
                    labels.push(now);
                    historyData.push(data.players.online);
                    playerChart.update();

                    // 玩家清單與頭像
                    const container = document.getElementById('player-container');
                    const currentList = data.players.list || [];
                    container.innerHTML = currentList.map(name => `
                        <div class="player-unit">
                            <img src="https://minotar.net/avatar/${name}/40" alt="skin">
                            <div><span style="color:var(--green)">${name}</span><br>
                            <small style="color:#666">追蹤中 - 狀態: 穩定</small></div>
                        </div>
                    `).join('');

                    // 紀錄邏輯
                    const logBox = document.getElementById('log-box');
                    currentList.forEach(p => { if(!lastList.includes(p)) logBox.innerHTML = `<div style="color:var(--green)">[${now}] ENTITY_JOIN: ${p}</div>` + logBox.innerHTML; });
                    lastList.forEach(p => { if(!currentList.includes(p)) logBox.innerHTML = `<div style="color:#ff4444">[${now}] ENTITY_LEAVE: ${p}</div>` + logBox.innerHTML; });
                    lastList = currentList;
                }
            } catch (e) {}
        }
        setInterval(update, 15000);
        update();
    </script>
</body>
</html>
