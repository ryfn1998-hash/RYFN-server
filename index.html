<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <title>2B2T - 核心數據監控中心</title>
    <style>
        :root { --green: #72bd44; --bg: #0d0d0d; }
        body { background: var(--bg); color: white; font-family: 'Courier New', monospace; padding: 20px; }
        .card { border: 1px solid #333; background: #111; padding: 20px; margin-bottom: 20px; border-left: 5px solid var(--green); }
        .title { color: var(--green); font-weight: bold; margin-bottom: 15px; font-size: 1.2rem; }
        .history-box { background: #000; height: 450px; overflow-y: auto; padding: 15px; border: 1px solid #222; font-size: 0.9rem; }
        .history-item { border-bottom: 1px solid #1a1a1a; padding: 8px 0; color: #888; }
        .highlight { color: var(--green); }
        .warning { color: #ff4444; }
    </style>
</head>
<body>
    <h2 style="color: var(--green);">MONITORING TARGET: 2b2t.org</h2>

    <div class="card">
        <div class="title">REAL-TIME STATUS (2B2T.ORG)</div>
        <div style="display: flex; gap: 50px;">
            <div>狀態: <span id="status" class="highlight">掃描中...</span></div>
            <div>目前總在線: <span id="online" class="highlight">-</span></div>
            <div>版本: <span id="version" class="highlight">-</span></div>
        </div>
    </div>

    <div class="card">
        <div class="title">2B2T 歷史活動日誌 (5分鐘/次)</div>
        <div class="history-box" id="history-content">正在從雲端載入 2b2t 歷史封包...</div>
    </div>

    <script>
        // 即時監控 2b2t
        async function fetch2b2t() {
            try {
                const res = await fetch('https://api.mcsrvstat.us/2/2b2t.org');
                const data = await res.json();
                if (data.online) {
                    document.getElementById('status').innerText = "ONLINE";
                    document.getElementById('online').innerText = data.players.online;
                    document.getElementById('version').innerText = data.version;
                } else {
                    document.getElementById('status').innerText = "OFFLINE";
                    document.getElementById('status').className = "warning";
                }
            } catch (e) { console.error("API Error"); }
        }

        // 加載歷史存檔
        async function loadHistory() {
            const container = document.getElementById('history-content');
            try {
                const res = await fetch('data/2b2t_history.log');
                if (!res.ok) throw new Error();
                const text = await res.text();
                const lines = text.trim().split('\n').reverse();
                
                container.innerHTML = lines.map(line => {
                    const parts = line.split('|');
                    return `<div class="history-item">
                        <span style="color:#555">[${parts[0].trim()}]</span> 
                        <span class="highlight">${parts[1]}</span> | 
                        <span>${parts[2]}</span>
                    </div>`;
                }).join('');
            } catch (e) {
                container.innerHTML = "等待 GitHub Actions 完成第一次數據存檔 (約需5分鐘)...";
            }
        }

        fetch2b2t();
        loadHistory();
        setInterval(fetch2b2t, 30000); // 30秒更新即時狀態
    </script>
</body>
</html>
